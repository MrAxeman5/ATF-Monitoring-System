<!DOCTYPE html>
<html>
<head>
  <title>Farming Simulator Map</title>
  <style>
    html,
    body {
  height: 100%;
  margin: 0;
  padding: 0;
}

#map {
  height: 100vh; /* Set the map height to 100% of the viewport height */
}

  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    var players = JSON.parse('<%- JSON.stringify(players) %>');
    var imageUrl = '<%- imageUrl %>';

    // Define the dimensions of the map image
    var imageWidth = 2048; // Replace with the actual width of the image
    var imageHeight = 2048; // Replace with the actual height of the image

    // Initialize the map with the Simple CRS
var map = L.map('map', {
  crs: L.CRS.Simple,
  maxBounds: [[0, 0], [imageHeight, imageWidth]]
});

// Set the image overlay with the map image and bounds
var imageBounds = [[0, 0], [imageHeight, imageWidth]];
L.imageOverlay(imageUrl, imageBounds).addTo(map);

// Calculate the center position of the image
var centerX = imageWidth / 2;
var centerY = imageHeight / 2;

// Set the map view to the center position
map.setView([centerY, centerX], 1);

// Update the map size on window resize
window.addEventListener('resize', function() {
  map.invalidateSize(); // Refresh the map size
});


    // Plot the players on the map
    // Iterate over the players array and create markers for each player
players.forEach(player => {
  var playerName = player._;
  var playerX = parseFloat(player.$.x);
  var playerY = parseFloat(player.$.y);
  var playerPosition = [playerY, playerX];

  // Create a marker for the player
  var playerMarker = L.marker(playerPosition).addTo(map);
  playerMarker.bindPopup(playerName); // Set the player name as the marker popup content
});

  </script>
</body>
</html>
